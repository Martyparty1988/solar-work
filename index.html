<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#1e293b">
    <title>Solar Work Count Lithuania by Marty Party</title>

    <!-- App assets -->
    <link rel="manifest" href="manifest.json">
    <link rel="stylesheet" href="style.css">

    <!-- Nov√© Inter font -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <!-- PDF.js Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js"></script>
</head>
<body data-version="4.1">
    <!-- Toast Notification -->
    <div id="toast" class="toast" role="alert" aria-live="polite"></div>

    <!-- Loader -->
    <div id="loader" class="loader" role="status" aria-label="Naƒç√≠t√°n√≠">
        <div class="loader-spinner"></div>
    </div>

    <!-- Header -->
    <div class="header">
        <h1>Solar Work Count Lithuania v4.1</h1>
        <div style="font-size: 12px; color: var(--color-text-secondary); margin-top: 4px;">by Marty Party ¬∑ ü§ñ AI Ready</div>
    </div>

    <!-- Pages Container -->
    <div class="pages-container">
        
        <!-- ============================================= -->
        <!-- PAGE 1: PL√ÅN - s AI ovl√°d√°n√≠m               -->
        <!-- ============================================= -->
        <div id="page-plan" class="page active" data-page-name="plan">
            <div class="plan-card">
                
                <!-- Hlaviƒçka Karty -->
                <div class="plan-header">
                    <div>
                        <h2 id="plan-title" class="plan-title" data-dynamic="plan-title">Vyberte projekt</h2>
                        <select id="project-picker" 
                                class="project-select form-control" 
                                data-role="picker" 
                                data-action="select-project"
                                aria-label="V√Ωbƒõr projektu"
                                style="margin-top: 16px; max-width: 300px;">
                            <option value="">-- Vyberte projekt --</option>
                        </select>
                    </div>
                    <div id="plan-actions" class="plan-actions" style="display: none;">
                        <button id="plan-stats-button" 
                                class="action-btn"
                                data-action="view-stats"
                                aria-label="Zobrazit statistiky projektu">
                            Statistika
                        </button>
                        <button id="plan-edit-button" 
                                class="action-btn"
                                data-action="edit-project"
                                aria-label="Upravit projekt">
                            Upravit
                        </button>
                        <button id="ai-mode-toggle" 
                                class="action-btn btn-secondary"
                                data-action="toggle-ai-mode"
                                aria-label="P≈ôepnout AI re≈æim"
                                onclick="toggleAIMode()">
                            ü§ñ AI
                        </button>
                    </div>
                </div>

                <!-- Ovl√°d√°n√≠ PDF -->
                <div id="pdf-controls" class="pdf-controls" style="display: none;">
                    <div class="flex gap-8">
                        <button id="prev-page" 
                                class="btn-secondary pdf-control-btn action-btn" 
                                data-action="prev-page"
                                aria-label="P≈ôedchoz√≠ strana">‚Äπ</button>
                        <span id="page-indicator" 
                              class="page-indicator" 
                              data-info="page-indicator"
                              aria-live="polite">Strana 1 / 1</span>
                        <button id="next-page" 
                                class="btn-secondary pdf-control-btn action-btn" 
                                data-action="next-page"
                                aria-label="Dal≈°√≠ strana">‚Ä∫</button>
                    </div>
                    <div class="flex gap-8">
                        <button id="zoom-out" 
                                class="btn-secondary pdf-control-btn action-btn" 
                                data-action="zoom-out"
                                aria-label="Odd√°lit">-</button>
                        <button id="reset-zoom" 
                                class="btn-secondary pdf-control-btn action-btn" 
                                data-action="reset-zoom"
                                aria-label="Resetovat zoom">Reset</button>
                        <button id="zoom-in" 
                                class="btn-secondary pdf-control-btn action-btn" 
                                data-action="zoom-in"
                                aria-label="P≈ôibl√≠≈æit">+</button>
                    </div>
                </div>

                <!-- PDF Preview (Canvas) -->
                <div id="canvas-wrapper" class="pdf-preview">
                    <canvas id="pdf-canvas" 
                            class="plan-canvas"
                            data-surface="plan" 
                            role="img" 
                            aria-label="PDF pl√°n s piny"></canvas>
                    <div id="no-plan-message" class="empty-state" style="border: none; background: transparent;">
                        <div class="empty-state-icon">üìã</div>
                        <div>Pro zobrazen√≠ pl√°nu vyberte projekt v√Ω≈°e.</div>
                        <button onclick="navigateTo('settings')" 
                                class="btn btn-primary mt-16"
                                data-action="go-to-settings">
                            P≈ôidat Projekt
                        </button>
                    </div>
                </div>

                <!-- Legenda / Badges Pracovn√≠k≈Ø -->
                <div id="worker-badges-container" class="worker-badges-container" style="display: none;">
                    <h4 style="font-size: 14px; font-weight: 600; color: var(--color-text-secondary); margin-bottom: 12px;">Legenda:</h4>
                    <div id="worker-badges" class="worker-badges" data-info="worker-legend">
                        <!-- Badges budou generov√°ny pom√≠c√≠ JS -->
                    </div>
                </div>
            </div>
        </div>

        <!-- ============================================= -->
        <!-- PAGE 2: Z√ÅZNAMY - s AI ovl√°d√°n√≠m            -->
        <!-- ============================================= -->
        <div id="page-records" class="page" data-page-name="records">
            <div class="card mb-16">
                <h2 class="mb-16" style="font-size: 18px;">‚è±Ô∏è ƒåasovaƒç Smƒõny</h2>
                <div class="form-group">
                    <label class="form-label">Pracovn√≠k</label>
                    <select id="timer-worker" 
                            class="worker-select form-control" 
                            data-role="picker"
                            data-field="timer-worker"
                            aria-label="V√Ωbƒõr pracovn√≠ka pro ƒçasovaƒç">
                        <option value="">-- Vyberte pracovn√≠ka --</option>
                    </select>
                </div>
                <div id="timer-display" 
                     class="timer-display" 
                     data-info="timer-display"
                     aria-live="polite" 
                     aria-label="ƒåas smƒõny">00:00:00</div>
                     
                <div class="flex gap-8">
                    <button id="start-shift" 
                            class="action-btn btn btn-success w-full" 
                            data-action="start-shift"
                            role="button"
                            aria-label="Zaƒç√≠t smƒõnu"
                            aria-controls="timer-display">
                        ‚ñ∂Ô∏è Zaƒç√≠t Smƒõnu
                    </button>
                    <button id="stop-shift" 
                            class="action-btn btn btn-danger w-full" 
                            data-action="stop-shift"
                            role="button"
                            aria-label="Ukonƒçit smƒõnu"
                            aria-controls="timer-display"
                            style="display: none;">
                        ‚èπÔ∏è Ukonƒçit Smƒõnu
                    </button>
                </div>
            </div>

            <!-- Ruƒçn√≠ Zad√°n√≠ -->
            <div class="card mb-16">
                <h2 class="mb-16" style="font-size: 18px;">üìù Ruƒçn√≠ Zad√°n√≠ Z√°znamu</h2>
                <div class="flex gap-8">
                    <button onclick="openManualHourModal()" 
                            id="add-manual-hours" 
                            class="action-btn btn btn-secondary w-full"
                            data-action="add-manual-hours"
                            aria-label="Zadat hodiny ruƒçnƒõ">
                        Zadat Hodiny
                    </button>
                    <button onclick="openManualTaskModal()" 
                            id="add-manual-tasks" 
                            class="action-btn btn btn-secondary w-full"
                            data-action="add-manual-tasks"
                            aria-label="Zadat stoly ruƒçnƒõ">
                        Zadat Stoly
                    </button>
                </div>
            </div>

            <h2 style="font-size: 18px; margin-bottom: 16px;">üìÑ V≈°echny Z√°znamy</h2>
            <div class="card mb-16">
                <h3 class="mb-16" style="font-size: 16px;">Filtry z√°znam≈Ø</h3>
                <div class="form-group">
                    <label class="form-label">Typ</label>
                    <select id="records-filter" 
                            class="filter-select form-control" 
                            data-role="filter" 
                            data-field="type"
                            aria-label="Filtr podle typu z√°znamu">
                        <option value="all">V≈°e</option>
                        <option value="task">Stoly</option>
                        <option value="hourly">Hodiny</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Pracovn√≠k</label>
                    <select id="records-worker-filter" 
                            class="filter-select form-control" 
                            data-role="filter" 
                            data-field="worker"
                            aria-label="Filtr podle pracovn√≠ka">
                        <option value="">V≈°ichni pracovn√≠ci</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Projekt</label>
                    <select id="records-project-filter" 
                            class="filter-select form-control" 
                            data-role="filter" 
                            data-field="project"
                            aria-label="Filtr podle projektu">
                        <option value="">V≈°echny projekty</option>
                    </select>
                </div>
                <div class="form-group mb-8">
                    <label class="form-label">Obdob√≠</label>
                    <select id="records-date-filter" 
                            class="filter-select form-control" 
                            data-role="filter" 
                            data-field="date"
                            aria-label="Filtr podle obdob√≠">
                        <option value="all">V≈°echna data</option>
                        <option value="today">Dnes</option>
                        <option value="this_week">Tento t√Ωden</option>
                        <option value="this_month">Tento mƒõs√≠c</option>
                    </select>
                </div>
            </div>

            <div id="records-list" data-content="records-list" role="list" aria-label="Seznam z√°znam≈Ø"></div>
        </div>

        <!-- ============================================= -->
        <!-- PAGE 3: STATISTIKY - s AI ovl√°d√°n√≠m        -->
        <!-- ============================================= -->
        <div id="page-statistics" class="page" data-page-name="statistics">
            <div class="stats-grid">
                <div class="stat-card" data-kpi="total-earnings">
                    <div class="stat-value" id="stat-total-earnings" data-value="total-earnings">‚Ç¨0</div>
                    <div class="stat-label">Celkov√© V√Ωdƒõlky</div>
                </div>
                <div class="stat-card" data-kpi="total-hours">
                    <div class="stat-value" id="stat-total-hours" data-value="total-hours">0h</div>
                    <div class="stat-label">Celkov√© Hodiny</div>
                </div>
                <div class="stat-card" data-kpi="total-tables">
                    <div class="stat-value" id="stat-total-tables" data-value="total-tables">0</div>
                    <div class="stat-label">Celkem Stol≈Ø</div>
                </div>
                <div class="stat-card" data-kpi="avg-reward">
                    <div class="stat-value" id="stat-avg-reward" data-value="avg-reward">‚Ç¨0</div>
                    <div class="stat-label">Pr≈Ømƒõr/St≈Øl</div>
                </div>
            </div>

            <div class="card mb-16">
                <h3 class="mb-16" style="font-size: 16px;">Filtry</h3>
                <div class="form-group">
                    <label class="form-label">Pracovn√≠k</label>
                    <select id="stats-worker-filter" 
                            class="filter-select form-control"
                            data-role="filter"
                            data-field="stats-worker"
                            aria-label="Filtr pracovn√≠ka pro statistiky">
                        <option value="">V≈°ichni pracovn√≠ci</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Projekt</label>
                    <select id="stats-project-filter" 
                            class="filter-select form-control"
                            data-role="filter"
                            data-field="stats-project"
                            aria-label="Filtr projektu pro statistiky">
                        <option value="">V≈°echny projekty</option>
                    </select>
                </div>
            </div>

            <h3 class="mb-16" style="font-size: 16px;">üìà V√Ωdƒõlky podle Pracovn√≠k≈Ø</h3>
            <div id="worker-earnings-chart" 
                 class="chart-placeholder"
                 data-chart="worker-earnings"
                 role="img"
                 aria-label="Graf v√Ωdƒõlk≈Ø podle pracovn√≠k≈Ø">
                <div>Graf se zobraz√≠ zde</div>
            </div>

            <h3 class="mb-16" style="font-size: 16px;">üìä Rozdƒõlen√≠: Stoly vs Hodiny</h3>
            <div id="task-vs-hourly-chart" 
                 class="chart-placeholder"
                 data-chart="task-vs-hourly"
                 role="img"
                 aria-label="Graf rozdƒõlen√≠ stoly vs hodiny">
                <div>Graf se zobraz√≠ zde</div>
            </div>
        </div>

        <!-- ============================================= -->
        <!-- PAGE 4: NASTAVEN√ç - s AI ovl√°d√°n√≠m        -->
        <!-- ============================================= -->
        <div id="page-settings" class="page" data-page-name="settings">
            <div class="card mb-24">
                <h2 class="mb-16" style="font-size: 18px;">üíº Spr√°va Projekt≈Ø</h2>
                <button onclick="openProjectModal()" 
                        id="add-new-project" 
                        class="action-btn btn btn-primary w-full mb-16"
                        data-action="add-project"
                        aria-label="P≈ôidat nov√Ω projekt">
                    P≈ôidat Nov√Ω Projekt
                </button>
                <div id="projects-list" 
                     data-content="projects-list" 
                     role="list" 
                     aria-label="Seznam projekt≈Ø"></div>
            </div>

            <div class="card mb-24">
                <h2 class="mb-16" style="font-size: 18px;">üë• Spr√°va Pracovn√≠k≈Ø</h2>
                <button onclick="openWorkerModal()" 
                        id="add-new-worker" 
                        class="action-btn btn btn-primary w-full mb-16"
                        data-action="add-worker"
                        aria-label="P≈ôidat nov√©ho pracovn√≠ka">
                    P≈ôidat Nov√©ho Pracovn√≠ka
                </button>
                <div id="workers-list" 
                     data-content="workers-list" 
                     role="list" 
                     aria-label="Seznam pracovn√≠k≈Ø"></div>
            </div>

            <div class="card mb-24">
                <h2 class="mb-16" style="font-size: 18px;">üìÖ Denn√≠ Report</h2>
                <div class="form-group">
                    <label class="form-label">Datum</label>
                    <input type="date" 
                           id="report-date" 
                           class="date-input form-control"
                           data-field="report-date"
                           aria-label="Datum pro report">
                </div>
                <button onclick="generateDailyReport()" 
                        id="generate-report" 
                        class="action-btn btn btn-primary w-full"
                        data-action="generate-report"
                        aria-label="Generovat denn√≠ report">
                    Generovat Denn√≠ Report
                </button>
            </div>

            <div class="card mb-24">
                <h2 class="mb-16" style="font-size: 18px;">üóúÔ∏è Z√°loha a Export</h2>
                <div class="flex gap-8 mb-12">
                    <button id="backup-data" 
                            class="action-btn btn btn-secondary w-full"
                            data-action="backup-data"
                            aria-label="Z√°lohovat v≈°echna data">
                        Z√°lohovat Data
                    </button>
                    <button id="restore-data" 
                            class="action-btn btn btn-primary w-full"
                            data-action="restore-data"
                            aria-label="Obnovit data ze z√°lohy">
                        Obnovit Data
                    </button>
                </div>
                
                <button id="export-csv" 
                        class="action-btn btn btn-secondary w-full" 
                        data-action="export-csv"
                        aria-label="Exportovat z√°znamy do CSV"
                        style="background: rgba(34, 197, 94, 0.2); color: var(--color-success); border-color: var(--color-success);">
                    üìÅ Exportovat Z√°znamy (CSV)
                </button>
                
                <input type="file" 
                       id="restore-file-input" 
                       class="file-input"
                       data-field="restore-file"
                       accept="application/json" 
                       style="display: none;"
                       aria-label="Vybrat soubor z√°lohy">
                       
                <p style="font-size: 12px; color: var(--color-text-secondary); margin-top: 12px;">
                    Z√°loha (.json) ulo≈æ√≠ v≈°e (vƒçetnƒõ PDF). Export (.csv) ulo≈æ√≠ pouze z√°znamy o pr√°ci pro Excel.
                </p>
            </div>
        </div>
    </div>

    <!-- ============================================= -->
    <!-- SPODN√ç NAVIGACE - s AI identifik√°tory        -->
    <!-- ============================================= -->
    <nav class="bottom-nav" role="navigation" aria-label="Hlavn√≠ navigace">
        <div class="nav-item active" 
             onclick="navigateTo('plan')" 
             data-page="plan"
             data-nav="plan"
             role="button"
             tabindex="0"
             aria-label="P≈ôej√≠t na pl√°n">
            <div class="nav-icon">üìã</div>
            <div class="nav-label">Pl√°n</div>
        </div>
        <div class="nav-item" 
             onclick="navigateTo('records')" 
             data-page="records"
             data-nav="records"
             role="button"
             tabindex="0"
             aria-label="P≈ôej√≠t na z√°znamy">
            <div class="nav-icon">üìù</div>
            <div class="nav-label">Z√°znamy</div>
        </div>
        <div class="nav-item" 
             onclick="navigateTo('statistics')" 
             data-page="statistics"
             data-nav="statistics"
             role="button"
             tabindex="0"
             aria-label="P≈ôej√≠t na statistiky">
            <div class="nav-icon">üìà</div>
            <div class="nav-label">Statistiky</div>
        </div>
        <div class="nav-item" 
             onclick="navigateTo('settings')" 
             data-page="settings"
             data-nav="settings"
             role="button"
             tabindex="0"
             aria-label="P≈ôej√≠t na nastaven√≠">
            <div class="nav-icon">‚öôÔ∏è</div>
            <div class="nav-label">Nastaven√≠</div>
        </div>
    </nav>

    <!-- ============================================= -->
    <!-- MOD√ÅLY s AI ovl√°d√°n√≠m                        -->
    <!-- ============================================= -->

    <!-- Mod√°l: P≈ôidat/Upravit Projekt -->
    <div id="project-modal" class="modal" role="dialog" aria-labelledby="project-modal-title">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="project-modal-title">P≈ôidat Nov√Ω Projekt</h3>
                <button class="modal-close" 
                        onclick="closeModal('project-modal')"
                        data-action="close-modal"
                        aria-label="Zav≈ô√≠t mod√°l">&times;</button>
            </div>
            <form id="project-form" onsubmit="saveProject(event)" data-form="project">
                <input type="hidden" id="project-id" data-field="project-id">
                <div class="form-group">
                    <label class="form-label">Jm√©no Projektu</label>
                    <input type="text" 
                           id="project-name" 
                           class="text-input form-control" 
                           data-field="project-name"
                           aria-label="Jm√©no projektu" 
                           required>
                </div>
                <div class="form-group">
                    <label class="form-label">Pl√°n PDF</label>
                    <input type="file" 
                           id="project-pdf" 
                           class="file-input form-control" 
                           data-field="project-pdf"
                           aria-label="PDF soubor s pl√°nem"
                           accept="application/pdf">
                    <div id="current-pdf" 
                         data-info="current-pdf"
                         style="font-size: 12px; color: var(--color-text-secondary); margin-top: 8px;"></div>
                </div>
                <div class="flex gap-8">
                    <button type="button" 
                            onclick="closeModal('project-modal')" 
                            class="action-btn btn btn-secondary w-full"
                            data-action="cancel">
                        Zru≈°it
                    </button>
                    <button type="submit" 
                            class="action-btn btn btn-primary w-full"
                            data-action="save-project"
                            aria-label="Ulo≈æit projekt">
                        Ulo≈æit
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Mod√°l: P≈ôidat/Upravit Pracovn√≠ka -->
    <div id="worker-modal" class="modal" role="dialog" aria-labelledby="worker-modal-title">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="worker-modal-title">P≈ôidat Nov√©ho Pracovn√≠ka</h3>
                <button class="modal-close" 
                        onclick="closeModal('worker-modal')"
                        data-action="close-modal"
                        aria-label="Zav≈ô√≠t mod√°l">&times;</button>
            </div>
            <form id="worker-form" onsubmit="saveWorker(event)" data-form="worker">
                <input type="hidden" id="worker-id" data-field="worker-id">
                <div class="form-group">
                    <label class="form-label">Jm√©no</label>
                    <input type="text" 
                           id="worker-name" 
                           class="text-input form-control" 
                           data-field="worker-name"
                           aria-label="Jm√©no pracovn√≠ka" 
                           required>
                </div>
                <div class="form-group">
                    <label class="form-label">ƒå√≠slo/K√≥d (pro pl√°n)</label>
                    <input type="text" 
                           id="worker-code" 
                           class="text-input form-control" 
                           data-field="worker-code"
                           aria-label="K√≥d pracovn√≠ka"
                           placeholder="Nap≈ô: 1, 007, MP">
                </div>
                <div class="form-group">
                    <label class="form-label">Hodinov√° Sazba (‚Ç¨)</label>
                    <input type="number" 
                           id="worker-rate" 
                           class="number-input form-control" 
                           data-field="worker-rate"
                           aria-label="Hodinov√° sazba"
                           step="0.01" min="0" required>
                </div>
                <div class="flex gap-8">
                    <button type="button" 
                            onclick="closeModal('worker-modal')" 
                            class="action-btn btn btn-secondary w-full"
                            data-action="cancel">
                        Zru≈°it
                    </button>
                    <button type="submit" 
                            class="action-btn btn btn-primary w-full"
                            data-action="save-worker"
                            aria-label="Ulo≈æit pracovn√≠ka">
                        Ulo≈æit
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Mod√°l: P≈ôidat √ökol (z pl√°nu) -->
    <div id="task-modal" class="modal" role="dialog" aria-labelledby="task-modal-title">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="task-modal-title">Zadat Hotov√Ω St≈Øl</h3>
                <button class="modal-close" 
                        onclick="closeModal('task-modal')"
                        data-action="close-modal"
                        aria-label="Zav≈ô√≠t mod√°l">&times;</button>
            </div>
            <form id="task-form" onsubmit="saveTask(event)" data-form="task">
                <input type="hidden" id="task-entry-id" data-field="task-entry-id">
                <input type="hidden" id="task-x" data-field="task-x">
                <input type="hidden" id="task-y" data-field="task-y">
                
                <div class="form-group">
                    <label class="form-label">Pracovn√≠ci</label>
                    <div id="task-worker-checklist" 
                         class="worker-checklist"
                         data-checklist="task-workers"
                         role="group"
                         aria-label="V√Ωbƒõr pracovn√≠k≈Ø pro st≈Øl">
                        <!-- Bude naplnƒõno JS -->
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">ƒå√≠slo Stolu/Stringu</label>
                    <input type="text" 
                           id="table-number" 
                           class="table-input form-control" 
                           data-field="table-number"
                           aria-label="ƒå√≠slo stolu" 
                           required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Odmƒõna na pracovn√≠ka (‚Ç¨)</label>
                    <input type="number" 
                           id="reward-per-worker" 
                           class="reward-input form-control" 
                           data-field="reward-per-worker"
                           aria-label="Odmƒõna na jednoho pracovn√≠ka"
                           step="0.01" min="0" required>
                </div>
                
                <div class="flex gap-8">
                    <button type="button" 
                            onclick="closeModal('task-modal')" 
                            class="action-btn btn btn-secondary w-full"
                            data-action="cancel">
                        Zru≈°it
                    </button>
                    <button type="submit" 
                            class="action-btn btn btn-primary w-full"
                            data-action="save-task"
                            aria-label="Ulo≈æit st≈Øl">
                        Ulo≈æit
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Mod√°l: Ruƒçn√≠ Hodiny -->
    <div id="manual-hour-modal" class="modal" role="dialog" aria-labelledby="manual-hour-modal-title">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="manual-hour-modal-title">Zadat Ruƒçn√≠ Hodiny</h3>
                <button class="modal-close" 
                        onclick="closeModal('manual-hour-modal')"
                        data-action="close-modal"
                        aria-label="Zav≈ô√≠t mod√°l">&times;</button>
            </div>
            <form id="manual-hour-form" onsubmit="saveManualHours(event)" data-form="manual-hours">
                <div class="form-group">
                    <label class="form-label">Pracovn√≠k</label>
                    <select id="manual-hour-worker" 
                            class="worker-select form-control" 
                            data-role="picker"
                            data-field="manual-hour-worker"
                            aria-label="Vybrat pracovn√≠ka pro ruƒçn√≠ hodiny" 
                            required></select>
                </div>
                <div class="form-group">
                    <label class="form-label">Datum</label>
                    <input type="date" 
                           id="manual-hour-date" 
                           class="date-input form-control" 
                           data-field="manual-hour-date"
                           aria-label="Datum ruƒçn√≠ch hodin" 
                           required>
                </div>
                <div class="form-group">
                    <label class="form-label">Poƒçet Hodin</label>
                    <input type="number" 
                           id="manual-hour-total-hours" 
                           class="number-input form-control" 
                           data-field="manual-hour-total-hours"
                           aria-label="Poƒçet odpracovan√Ωch hodin"
                           step="0.1" min="0" required>
                </div>
                <div class="flex gap-8">
                    <button type="button" 
                            onclick="closeModal('manual-hour-modal')" 
                            class="action-btn btn btn-secondary w-full"
                            data-action="cancel">
                        Zru≈°it
                    </button>
                    <button type="submit" 
                            class="action-btn btn btn-primary w-full"
                            data-action="save-manual-hours"
                            aria-label="Ulo≈æit ruƒçn√≠ hodiny">
                        Ulo≈æit
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Mod√°l: Ruƒçn√≠ Stoly -->
    <div id="manual-task-modal" class="modal" role="dialog" aria-labelledby="manual-task-modal-title">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="manual-task-modal-title">Zadat Stoly Ruƒçnƒõ</h3>
                <button class="modal-close" 
                        onclick="closeModal('manual-task-modal')"
                        data-action="close-modal"
                        aria-label="Zav≈ô√≠t mod√°l">&times;</button>
            </div>
            <form id="manual-task-form" onsubmit="saveManualTask(event)" data-form="manual-tasks">
                
                <div class="form-group">
                    <label class="form-label">Pracovn√≠ci</label>
                    <div id="manual-task-worker-checklist" 
                         class="worker-checklist"
                         data-checklist="manual-task-workers"
                         role="group"
                         aria-label="V√Ωbƒõr pracovn√≠k≈Ø pro ruƒçn√≠ stoly">
                        <!-- Bude naplnƒõno JS -->
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">Projekt</label>
                    <select id="manual-task-project" 
                            class="project-select form-control" 
                            data-role="picker"
                            data-field="manual-task-project"
                            aria-label="Vybrat projekt pro ruƒçn√≠ stoly" 
                            required></select>
                </div>
                <div class="form-group">
                    <label class="form-label">Datum</label>
                    <input type="date" 
                           id="manual-task-date" 
                           class="date-input form-control" 
                           data-field="manual-task-date"
                           aria-label="Datum ruƒçn√≠ch stol≈Ø" 
                           required>
                </div>
                <div class="form-group">
                    <label class="form-label">ƒå√≠sla Stol≈Ø (oddƒõlte ƒç√°rkou, nap≈ô: 1, 2, 5A)</label>
                    <input type="text" 
                           id="manual-task-table-numbers" 
                           class="text-input form-control" 
                           data-field="manual-task-table-numbers"
                           aria-label="Seznam ƒç√≠sel stol≈Ø" 
                           required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Odmƒõna na pracovn√≠ka (‚Ç¨)</label>
                    <input type="number" 
                           id="manual-task-reward-per-worker" 
                           class="reward-input form-control" 
                           data-field="manual-task-reward-per-worker"
                           aria-label="Odmƒõna na jednoho pracovn√≠ka"
                           step="0.01" min="0" required>
                </div>

                <div class="flex gap-8">
                    <button type="button" 
                            onclick="closeModal('manual-task-modal')" 
                            class="action-btn btn btn-secondary w-full"
                            data-action="cancel">
                        Zru≈°it
                    </button>
                    <button type="submit" 
                            class="action-btn btn btn-primary w-full"
                            data-action="save-manual-tasks"
                            aria-label="Ulo≈æit ruƒçn√≠ stoly">
                        Ulo≈æit
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Mod√°l: Denn√≠ Report -->
    <div id="report-modal" class="modal" role="dialog" aria-labelledby="report-modal-title">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="report-modal-title">Denn√≠ Report</h3>
                <button class="modal-close" 
                        onclick="closeModal('report-modal')"
                        data-action="close-modal"
                        aria-label="Zav≈ô√≠t report">&times;</button>
            </div>
            <div id="report-content" 
                 data-content="report-content"
                 role="document"
                 aria-label="Obsah denn√≠ho reportu"
                 style="background: rgba(0,0,0,0.2); padding: 16px; border-radius: 8px; font-family: monospace; font-size: 14px; white-space: pre-wrap; max-height: 400px; overflow-y: auto; border: 1px solid rgba(255,255,255,0.1);"></div>
            <button onclick="copyReport()" 
                    id="copy-report" 
                    class="action-btn btn btn-primary w-full mt-16"
                    data-action="copy-report"
                    aria-label="Zkop√≠rovat report do schr√°nky">
                Kop√≠rovat Text
            </button>
        </div>
    </div>

    <!-- ============================================= -->
    <!-- SKRIPTY                                     -->
    <!-- ============================================= -->
    <script>
        // P≈ôipojit nov√© ID k star√Ωm (backward compatibility)
        function connectCompatibilityIds() {
            const idMappings = {
                'projectSelect': 'project-picker',
                'planTitle': 'plan-title',
                'planActions': 'plan-actions',
                'planStatsButton': 'plan-stats-button',
                'planEditButton': 'plan-edit-button',
                'pdfControls': 'pdf-controls',
                'prevPage': 'prev-page',
                'nextPage': 'next-page',
                'pageIndicator': 'page-indicator',
                'zoomOut': 'zoom-out',
                'zoomIn': 'zoom-in',
                'resetZoom': 'reset-zoom',
                'canvasWrapper': 'canvas-wrapper',
                'pdfCanvas': 'pdf-canvas',
                'noPlanMessage': 'no-plan-message',
                'workerBadgesContainer': 'worker-badges-container',
                'workerBadges': 'worker-badges',
                'recordsList': 'records-list',
                'timerWorker': 'timer-worker',
                'timerDisplay': 'timer-display',
                'startShift': 'start-shift',
                'stopShift': 'stop-shift',
                'recordsFilter': 'records-filter',
                'recordsWorkerFilter': 'records-worker-filter',
                'recordsProjectFilter': 'records-project-filter',
                'recordsDateFilter': 'records-date-filter',
                'statsWorkerFilter': 'stats-worker-filter',
                'statsProjectFilter': 'stats-project-filter',
                'statTotalEarnings': 'stat-total-earnings',
                'statTotalHours': 'stat-total-hours',
                'statTotalTables': 'stat-total-tables',
                'statAvgReward': 'stat-avg-reward',
                'workerEarningsChart': 'worker-earnings-chart',
                'taskVsHourlyChart': 'task-vs-hourly-chart',
                'projectsList': 'projects-list',
                'workersList': 'workers-list',
                'reportDate': 'report-date',
                'backupButton': 'backup-data',
                'restoreButton': 'restore-data',
                'exportCSV': 'export-csv',
                'restoreFileInput': 'restore-file-input',
                'reportContent': 'report-content',
                'projectModal': 'project-modal',
                'projectModalTitle': 'project-modal-title',
                'projectId': 'project-id',
                'projectName': 'project-name',
                'projectPDF': 'project-pdf',
                'currentPDF': 'current-pdf',
                'projectForm': 'project-form',
                'workerModal': 'worker-modal',
                'workerModalTitle': 'worker-modal-title',
                'workerId': 'worker-id',
                'workerName': 'worker-name',
                'workerCode': 'worker-code',
                'workerRate': 'worker-rate',
                'workerForm': 'worker-form',
                'taskModal': 'task-modal',
                'taskModalTitle': 'task-modal-title',
                'taskEntryId': 'task-entry-id',
                'taskX': 'task-x',
                'taskY': 'task-y',
                'taskWorkerChecklist': 'task-worker-checklist',
                'taskTableNumber': 'table-number',
                'taskRewardPerWorker': 'reward-per-worker',
                'taskForm': 'task-form',
                'manualHourModal': 'manual-hour-modal',
                'manualHourForm': 'manual-hour-form',
                'manualHourWorker': 'manual-hour-worker',
                'manualHourDate': 'manual-hour-date',
                'manualHourTotalHours': 'manual-hour-total-hours',
                'manualTaskModal': 'manual-task-modal',
                'manualTaskForm': 'manual-task-form',
                'manualTaskWorkerChecklist': 'manual-task-worker-checklist',
                'manualTaskProject': 'manual-task-project',
                'manualTaskDate': 'manual-task-date',
                'manualTaskTableNumbers': 'manual-task-table-numbers',
                'manualTaskRewardPerWorker': 'manual-task-reward-per-worker',
                'reportModal': 'report-modal'
            };
            
            // P≈ôidat star√© ID jako alias
            Object.entries(idMappings).forEach(([oldId, newId]) => {
                const newElement = document.getElementById(newId);
                if (newElement && !document.getElementById(oldId)) {
                    newElement.id = oldId; // Zachovat star√© ID pro kompatibilitu
                    newElement.setAttribute('data-new-id', newId); // Uchovat nov√© ID pro AI
                }
            });
        }
        
        // AI Mode Toggle
        function toggleAIMode() {
            if (window.SolarWorkAPI) {
                if (window.SolarWorkAPI.aiMode) {
                    window.SolarWorkAPI.disableAIMode();
                } else {
                    window.SolarWorkAPI.enableAIMode();
                }
            } else {
                showToast('AI API nen√≠ k dispozici', 'error');
            }
        }
        
        // Inicializace compatibility po naƒçten√≠ DOM
        document.addEventListener('DOMContentLoaded', () => {
            connectCompatibilityIds();
        });
    </script>
    
    <script src="app.js"></script>
    <script src="app_functions.js"></script>
</body>
</html>