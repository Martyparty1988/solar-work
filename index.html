<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#1e293b">
    <title>Solar Work Count Lithuania by Marty Party</title>

    <!-- App assets -->
    <link rel="manifest" href="manifest.json">
    <link rel="stylesheet" href="style.css">

    <!-- Naƒçten√≠ p√≠sma Inter (pro modern√≠ typografii) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <!-- PDF.js Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js"></script>
</head>
<body>
    <!-- Toast Notification -->
    <div id="toast" class="toast"></div>

    <!-- Loader -->
    <div id="loader" class="loader">
        <div class="loader-spinner"></div>
    </div>

    <!-- Header -->
    <div class="header">
        <h1>Solar Work Count Lithuania</h1>
        <div style="font-size: 12px; color: var(--color-text-secondary); margin-top: 4px;">by Marty Party</div>
    </div>

    <!-- Pages Container -->
    <div class="pages-container">
        
        <!-- ============================================= -->
        <!-- PAGE 1: PL√ÅN (P≈ôepracov√°no dle n√°vrhu)       -->
        <!-- ============================================= -->
        <div id="page-plan" class="page active">

            <!-- Nov√° Karta Pl√°nu -->
            <div class="plan-card">
                
                <!-- Hlaviƒçka Karty -->
                <div class="plan-header">
                    <div>
                        <h2 id="planTitle" class="plan-title">Vyberte projekt</h2>
                        <!-- Skryt√Ω select, kter√Ω ovl√°d√° kartu -->
                        <select id="projectSelect" class="form-control" style="margin-top: 16px; max-width: 300px;">
                            <option value="">-- Vyberte projekt --</option>
                        </select>
                    </div>
                    <div id="planActions" class="plan-actions" style="display: none;">
                        <button id="planStatsButton">Statistika</button>
                        <button id="planEditButton">Upravit</button>
                    </div>
                </div>

                <!-- Ovl√°d√°n√≠ PDF -->
                <div id="pdfControls" class="pdf-controls" style="display: none;">
                    <div class="flex gap-8">
                        <button id="prevPage" class="btn-secondary pdf-control-btn">‚Äπ</button>
                        <span id="pageIndicator" class="page-indicator">Strana 1 / 1</span>
                        <button id="nextPage" class="btn-secondary pdf-control-btn">‚Ä∫</button>
                    </div>
                    <div class="flex gap-8">
                        <button id="zoomOut" class="btn-secondary pdf-control-btn">-</button>
                        <button id="resetZoom" class="btn-secondary pdf-control-btn">Reset</button>
                        <button id="zoomIn" class="btn-secondary pdf-control-btn">+</button>
                    </div>
                </div>

                <!-- PDF Preview (Canvas) -->
                <div id="canvasWrapper" class="pdf-preview">
                    <canvas id="pdfCanvas"></canvas>
                    <div id="noPlanMessage" class="empty-state" style="border: none; background: transparent;">
                        <div class="empty-state-icon">üìã</div>
                        <div>Pro zobrazen√≠ pl√°nu vyberte projekt v√Ω≈°e.</div>
                        <button onclick="navigateTo('settings')" class="btn btn-primary mt-16">P≈ôidat Projekt</button>
                    </div>
                </div>

                <!-- Legenda / Badges Pracovn√≠k≈Ø -->
                <div id="workerBadgesContainer" class="worker-badges-container" style="display: none;">
                    <h4 style="font-size: 14px; font-weight: 600; color: var(--color-text-secondary); margin-bottom: 12px;">Legenda:</h4>
                    <div id="workerBadges" class="worker-badges">
                        <!-- Badges budou generov√°ny pomoc√≠ JS -->
                    </div>
                </div>

            </div>
            <!-- Konec Karty Pl√°nu -->
        </div>

        <!-- ============================================= -->
        <!-- PAGE 2: Z√ÅZNAMY                             -->
        <!-- ============================================= -->
        <div id="page-records" class="page">
            <div class="card mb-16">
                <h2 class="mb-16" style="font-size: 18px;">ƒåasovaƒç Smƒõny</h2>
                <div class="form-group">
                    <label class="form-label">Pracovn√≠k</label>
                    <select id="timerWorker" class="form-control">
                        <option value="">-- Vyberte pracovn√≠ka --</option>
                    </select>
                </div>
                <div class="timer-display" id="timerDisplay">00:00:00</div>
                <div class="flex gap-8">
                    <button id="startShift" class="btn btn-success w-full">Zaƒç√≠t Smƒõnu</button>
                    <button id="stopShift" class="btn btn-danger w-full" style="display: none;">Ukonƒçit Smƒõnu</button>
                </div>
            </div>

            <!-- Ruƒçn√≠ Zad√°n√≠ -->
            <div class="card mb-16">
                <h2 class="mb-16" style="font-size: 18px;">Ruƒçn√≠ Zad√°n√≠ Z√°znamu</h2>
                <div class="flex gap-8">
                    <button onclick="openManualHourModal()" class="btn btn-secondary w-full">Zadat Hodiny</button>
                    <button onclick="openManualTaskModal()" class="btn btn-secondary w-full">Zadat Stoly</button>
                </div>
            </div>

            <h2 style="font-size: 18px; margin-bottom: 16px;">V≈°echny Z√°znamy</h2>
            <div class="card mb-16">
                <h3 class="mb-16" style="font-size: 16px;">Filtry z√°znam≈Ø</h3>
                <div class="form-group">
                    <label class="form-label">Typ</label>
                    <select id="recordsFilter" class="form-control">
                        <option value="all">V≈°e</option>
                        <option value="task">Stoly</option>
                        <option value="hourly">Hodiny</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Pracovn√≠k</label>
                    <select id="recordsWorkerFilter" class="form-control">
                        <option value="">V≈°ichni pracovn√≠ci</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Projekt</label>
                    <select id="recordsProjectFilter" class="form-control">
                        <option value="">V≈°echny projekty</option>
                    </select>
                </div>
                <div class="form-group mb-8">
                    <label class="form-label">Obdob√≠</label>
                    <select id="recordsDateFilter" class="form-control">
                        <option value="all">V≈°echna data</option>
                        <option value="today">Dnes</option>
                        <option value="this_week">Tento t√Ωden</option>
                        <option value="this_month">Tento mƒõs√≠c</option>
                    </select>
                </div>
            </div>

            <div id="recordsList"></div>
        </div>

        <!-- ============================================= -->
        <!-- PAGE 3: STATISTIKY                          -->
        <!-- ============================================= -->
        <div id="page-statistics" class="page">
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value" id="statTotalEarnings">‚Ç¨0</div>
                    <div class="stat-label">Celkov√© V√Ωdƒõlky</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="statTotalHours">0h</div>
                    <div class="stat-label">Celkov√© Hodiny</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="statTotalTables">0</div>
                    <div class="stat-label">Celkem Stol≈Ø</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="statAvgReward">‚Ç¨0</div>
                    <div class="stat-label">Pr≈Ømƒõr/St≈Øl</div>
                </div>
            </div>

            <div class="card mb-16">
                <h3 class="mb-16" style="font-size: 16px;">Filtry</h3>
                <div class="form-group">
                    <label class="form-label">Pracovn√≠k</label>
                    <select id="statsWorkerFilter" class="form-control">
                        <option value="">V≈°ichni pracovn√≠ci</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Projekt</label>
                    <select id="statsProjectFilter" class="form-control">
                        <option value="">V≈°echny projekty</option>
                    </select>
                </div>
            </div>

            <h3 class="mb-16" style="font-size: 16px;">V√Ωdƒõlky podle Pracovn√≠k≈Ø</h3>
            <div id="workerEarningsChart" class="chart-placeholder">
                <div>Graf se zobraz√≠ zde</div>
            </div>

            <h3 class="mb-16" style="font-size: 16px;">Rozdƒõlen√≠: Stoly vs Hodiny</h3>
            <div id="taskVsHourlyChart" class="chart-placeholder">
                <div>Graf se zobraz√≠ zde</div>
            </div>
        </div>

        <!-- ============================================= -->
        <!-- PAGE 4: NASTAVEN√ç                           -->
        <!-- ============================================= -->
        <div id="page-settings" class="page">
            <div class="card mb-24">
                <h2 class="mb-16" style="font-size: 18px;">Spr√°va Projekt≈Ø</h2>
                <button onclick="openProjectModal()" class="btn btn-primary w-full mb-16">P≈ôidat Nov√Ω Projekt</button>
                <div id="projectsList"></div>
            </div>

            <div class="card mb-24">
                <h2 class="mb-16" style="font-size: 18px;">Spr√°va Pracovn√≠k≈Ø</h2>
                <button onclick="openWorkerModal()" class="btn btn-primary w-full mb-16">P≈ôidat Nov√©ho Pracovn√≠ka</button>
                <div id="workersList"></div>
            </div>

            <div class="card mb-24">
                <h2 class="mb-16" style="font-size: 18px;">Denn√≠ Report</h2>
                <div class="form-group">
                    <label class="form-label">Datum</label>
                    <input type="date" id="reportDate" class="form-control">
                </div>
                <button onclick="generateDailyReport()" class="btn btn-primary w-full">Generovat Denn√≠ Report</button>
            </div>

            <div class="card mb-24">
                <h2 class="mb-16" style="font-size: 18px;">Z√°loha a Obnova</h2>
                <div class="flex gap-8">
                    <button id="backupButton" class="btn btn-secondary w-full">Z√°lohovat Data</button>
                    <button id="restoreButton" class="btn btn-primary w-full">Obnovit Data</button>
                </div>
                <input type="file" id="restoreFileInput" accept="application/json" style="display: none;">
                <p style="font-size: 12px; color: var(--color-text-secondary); margin-top: 12px;">
                    Z√°loha ulo≈æ√≠ v≈°echny projekty, pracovn√≠ky, z√°znamy a nahran√© PDF soubory do jednoho .json souboru.
                    Obnova p≈ôep√≠≈°e v≈°echna aktu√°ln√≠ data!
                </p>
            </div>
        </div>
    </div>

    <!-- ============================================= -->
    <!-- SPODN√ç NAVIGACE                             -->
    <!-- ============================================= -->
    <nav class="bottom-nav">
        <div class="nav-item active" onclick="navigateTo('plan')" data-page="plan">
            <div class="nav-icon">üìã</div>
            <div class="nav-label">Pl√°n</div>
        </div>
        <div class="nav-item" onclick="navigateTo('records')" data-page="records">
            <div class="nav-icon">üìù</div>
            <div class="nav-label">Z√°znamy</div>
        </div>
        <div class="nav-item" onclick="navigateTo('statistics')" data-page="statistics">
            <div class="nav-icon">üìä</div>
            <div class="nav-label">Statistiky</div>
        </div>
        <div class="nav-item" onclick="navigateTo('settings')" data-page="settings">
            <div class="nav-icon">‚öôÔ∏è</div>
            <div class="nav-label">Nastaven√≠</div>
        </div>
    </nav>

    <!-- ============================================= -->
    <!-- MOD√ÅLY                                      -->
    <!-- ============================================= -->

    <!-- Mod√°l: P≈ôidat/Upravit Projekt -->
    <div id="projectModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="projectModalTitle">P≈ôidat Nov√Ω Projekt</h3>
                <button class="modal-close" onclick="closeModal('projectModal')">&times;</button>
            </div>
            <form id="projectForm" onsubmit="saveProject(event)">
                <input type="hidden" id="projectId">
                <div class="form-group">
                    <label class="form-label">Jm√©no Projektu</label>
                    <input type="text" id="projectName" class="form-control" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Pl√°n PDF</label>
                    <input type="file" id="projectPDF" class="form-control" accept="application/pdf">
                    <div id="currentPDF" style="font-size: 12px; color: var(--color-text-secondary); margin-top: 8px;"></div>
                </div>
                <div class="flex gap-8">
                    <button type="button" onclick="closeModal('projectModal')" class="btn btn-secondary w-full">Zru≈°it</button>
                    <button type="submit" class="btn btn-primary w-full">Ulo≈æit</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Mod√°l: P≈ôidat/Upravit Pracovn√≠ka -->
    <div id="workerModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="workerModalTitle">P≈ôidat Nov√©ho Pracovn√≠ka</h3>
                <button class="modal-close" onclick="closeModal('workerModal')">&times;</button>
            </div>
            <form id="workerForm" onsubmit="saveWorker(event)">
                <input type="hidden" id="workerId">
                <div class="form-group">
                    <label class="form-label">Jm√©no</label>
                    <input type="text" id="workerName" class="form-control" required>
                </div>
                <div class="form-group">
                    <label class="form-label">ƒå√≠slo/K√≥d (pro pl√°n)</label>
                    <input type="text" id="workerCode" class="form-control" placeholder="Nap≈ô: 1, 007, MP">
                </div>
                <div class="form-group">
                    <label class="form-label">Hodinov√° Sazba (‚Ç¨)</label>
                    <input type="number" id="workerRate" class="form-control" step="0.01" min="0" required>
                </div>
                <div class="flex gap-8">
                    <button type="button" onclick="closeModal('workerModal')" class="btn btn-secondary w-full">Zru≈°it</button>
                    <button type="submit" class="btn btn-primary w-full">Ulo≈æit</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Mod√°l: P≈ôidat √ökol (z pl√°nu) -->
    <div id="taskModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="taskModalTitle">Zadat Hotov√Ω St≈Øl</h3>
                <button class="modal-close" onclick="closeModal('taskModal')">&times;</button>
            </div>
            <form id="taskForm" onsubmit="saveTask(event)">
                <input type="hidden" id="taskEntryId">
                <input type="hidden" id="taskX">
                <input type="hidden" id="taskY">
                
                <!-- ZMƒöNA: Select nahrazen Checkboxy -->
                <div class="form-group">
                    <label class="form-label">Pracovn√≠ci</label>
                    <div id="taskWorkerChecklist" class="worker-checklist">
                        <!-- Bude naplnƒõno JS -->
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">ƒå√≠slo Stolu/Stringu</label>
                    <input type="text" id="taskTableNumber" class="form-control" required>
                </div>
                
                <!-- ZMƒöNA: P≈ôejmenov√°no id a label -->
                <div class="form-group">
                    <label class="form-label">Odmƒõna na pracovn√≠ka (‚Ç¨)</label>
                    <input type="number" id="taskRewardPerWorker" class="form-control" step="0.01" min="0" required>
                </div>
                
                <div class="flex gap-8">
                    <button type="button" onclick="closeModal('taskModal')" class="btn btn-secondary w-full">Zru≈°it</button>
                    <button type="submit" class="btn btn-primary w-full">Ulo≈æit</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Mod√°l: Ruƒçn√≠ Hodiny -->
    <div id="manualHourModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Zadat Ruƒçn√≠ Hodiny</h3>
                <button class="modal-close" onclick="closeModal('manualHourModal')">&times;</button>
            </div>
            <form id="manualHourForm" onsubmit="saveManualHours(event)">
                <div class="form-group">
                    <label class="form-label">Pracovn√≠k</label>
                    <select id="manualHourWorker" class="form-control" required></select>
                </div>
                <div class="form-group">
                    <label class="form-label">Datum</label>
                    <input type="date" id="manualHourDate" class="form-control" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Poƒçet Hodin</label>
                    <input type="number" id="manualHourTotalHours" class="form-control" step="0.1" min="0" required>
                </div>
                <div class="flex gap-8">
                    <button type="button" onclick="closeModal('manualHourModal')" class="btn btn-secondary w-full">Zru≈°it</button>
                    <button type="submit" class="btn btn-primary w-full">Ulo≈æit</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Mod√°l: Ruƒçn√≠ Stoly -->
    <div id="manualTaskModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Zadat Stoly Ruƒçnƒõ</h3>
                <button class="modal-close" onclick="closeModal('manualTaskModal')">&times;</button>
            </div>
            <form id="manualTaskForm" onsubmit="saveManualTask(event)">
                
                <!-- ZMƒöNA: Select nahrazen Checkboxy -->
                <div class="form-group">
                    <label class="form-label">Pracovn√≠ci</label>
                    <div id="manualTaskWorkerChecklist" class="worker-checklist">
                        <!-- Bude naplnƒõno JS -->
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">Projekt</label>
                    <select id="manualTaskProject" class="form-control" required></select>
                </div>
                <div class="form-group">
                    <label class="form-label">Datum</label>
                    <input type="date" id="manualTaskDate" class="form-control" required>
                </div>
                <div class="form-group">
                    <label class="form-label">ƒå√≠sla Stol≈Ø (oddƒõlte ƒç√°rkou, nap≈ô: 1, 2, 5A)</label>
                    <input type="text" id="manualTaskTableNumbers" class="form-control" required>
                </div>
                
                <!-- ZMƒöNA: P≈ôejmenov√°no id a label -->
                <div class="form-group">
                    <label class="form-label">Odmƒõna na pracovn√≠ka (‚Ç¨)</label>
                    <input type="number" id="manualTaskRewardPerWorker" class="form-control" step="0.01" min="0" required>
                </div>

                <div class="flex gap-8">
                    <button type="button" onclick="closeModal('manualTaskModal')" class="btn btn-secondary w-full">Zru≈°it</button>
                    <button type="submit" class="btn btn-primary w-full">Ulo≈æit</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Mod√°l: Denn√≠ Report -->
    <div id="reportModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Denn√≠ Report</h3>
                <button class="modal-close" onclick="closeModal('reportModal')">&times;</button>
            </div>
            <div id="reportContent" style="background: rgba(0,0,0,0.2); padding: 16px; border-radius: 8px; font-family: monospace; font-size: 14px; white-space: pre-wrap; max-height: 400px; overflow-y: auto; border: 1px solid rgba(255,255,255,0.1);"></div>
            <button onclick="copyReport()" class="btn btn-primary w-full mt-16">Kop√≠rovat Text</button>
        </div>
    </div>

    <script src="app.js"></script>
</body>
</html>

