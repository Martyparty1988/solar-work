<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, user-scalable=no">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#1e293b">
    <title>Solar Work Count Lithuania by Marty Party</title>

    <link rel="manifest" href="manifest.json">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="ai-styles.css">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js"></script>
</head>
<body data-version="4.1">
    <div id="toast" class="toast" role="alert" aria-live="polite"></div>
    <div id="loader" class="loader" role="status" aria-label="Naƒç√≠t√°n√≠"><div class="loader-spinner"></div></div>

    <div class="header">
        <h1>Solar Work Count Lithuania v4.1</h1>
        <div style="font-size: 12px; color: var(--color-text-secondary); margin-top: 4px;">by Marty Party ¬∑ ü§ñ AI Ready</div>
    </div>

    <div class="pages-container">
        <div id="page-plan" class="page active" data-page-name="plan">
            <div class="plan-card">
                <div class="plan-header">
                    <div>
                        <h2 id="plan-title" class="plan-title" data-dynamic="plan-title">Vyberte projekt</h2>
                        <select id="project-picker" class="project-select form-control" data-role="picker" data-action="select-project" aria-label="V√Ωbƒõr projektu" style="margin-top: 16px; max-width: 300px;">
                            <option value="">-- Vyberte projekt --</option>
                        </select>
                    </div>
                    <div id="plan-actions" class="plan-actions" style="display: none;">
                        <button id="plan-stats-button" class="action-btn" data-action="view-stats" aria-label="Zobrazit statistiky projektu">Statistika</button>
                        <button id="plan-edit-button" class="action-btn" data-action="edit-project" aria-label="Upravit projekt">Upravit</button>
                        <button id="ai-mode-toggle" class="action-btn btn-secondary" data-action="toggle-ai-mode" aria-label="P≈ôepnout AI re≈æim" onclick="toggleAIMode()">ü§ñ AI</button>
                    </div>
                </div>
                <div id="pdf-controls" class="pdf-controls" style="display: none;">
                    <div class="flex gap-8">
                        <button id="prev-page" class="btn-secondary pdf-control-btn action-btn" data-action="prev-page" aria-label="P≈ôedchoz√≠ strana">‚Äπ</button>
                        <span id="page-indicator" class="page-indicator" data-info="page-indicator" aria-live="polite">Strana 1 / 1</span>
                        <button id="next-page" class="btn-secondary pdf-control-btn action-btn" data-action="next-page" aria-label="Dal≈°√≠ strana">‚Ä∫</button>
                    </div>
                    <div class="flex gap-8">
                        <button id="zoom-out" class="btn-secondary pdf-control-btn action-btn" data-action="zoom-out" aria-label="Odd√°lit">-</button>
                        <button id="reset-zoom" class="btn-secondary pdf-control-btn action-btn" data-action="reset-zoom" aria-label="Resetovat zoom">Reset</button>
                        <button id="zoom-in" class="btn-secondary pdf-control-btn action-btn" data-action="zoom-in" aria-label="P≈ôibl√≠≈æit">+</button>
                    </div>
                </div>
                <div id="canvas-wrapper" class="pdf-preview">
                    <canvas id="pdf-canvas" class="plan-canvas" data-surface="plan" role="img" aria-label="PDF pl√°n s piny"></canvas>
                    <div id="no-plan-message" class="empty-state" style="border: none; background: transparent;">
                        <div class="empty-state-icon">üìã</div>
                        <div>Pro zobrazen√≠ pl√°nu vyberte projekt v√Ω≈°e.</div>
                        <button onclick="navigateTo('settings')" class="btn btn-primary mt-16" data-action="go-to-settings">P≈ôidat Projekt</button>
                    </div>
                </div>
                <div id="worker-badges-container" class="worker-badges-container" style="display: none;">
                    <h4 style="font-size: 14px; font-weight: 600; color: var(--color-text-secondary); margin-bottom: 12px;">Legenda:</h4>
                    <div id="worker-badges" class="worker-badges" data-info="worker-legend"></div>
                </div>
            </div>
        </div>

        <div id="page-records" class="page" data-page-name="records">
            <div class="card mb-16">
                <h2 class="mb-16" style="font-size: 18px;">‚è±Ô∏è ƒåasovaƒç Smƒõny</h2>
                <div class="form-group">
                    <label class="form-label">Pracovn√≠k</label>
                    <select id="timer-worker" class="worker-select form-control" data-role="picker" data-field="timer-worker" aria-label="V√Ωbƒõr pracovn√≠ka pro ƒçasovaƒç">
                        <option value="">-- Vyberte pracovn√≠ka --</option>
                    </select>
                </div>
                <div id="timer-display" class="timer-display" data-info="timer-display" aria-live="polite" aria-label="ƒåas smƒõny">00:00:00</div>
                <div class="flex gap-8">
                    <button id="start-shift" class="action-btn btn btn-success w-full" data-action="start-shift" role="button" aria-label="Zaƒç√≠t smƒõnu" aria-controls="timer-display">‚ñ∂Ô∏è Zaƒç√≠t Smƒõnu</button>
                    <button id="stop-shift" class="action-btn btn btn-danger w-full" data-action="stop-shift" role="button" aria-label="Ukonƒçit smƒõnu" aria-controls="timer-display" style="display: none;">‚èπÔ∏è Ukonƒçit Smƒõnu</button>
                </div>
            </div>

            <div class="card mb-16">
                <h2 class="mb-16" style="font-size: 18px;">üìù Ruƒçn√≠ Zad√°n√≠ Z√°znamu</h2>
                <div class="flex gap-8">
                    <button onclick="openManualHourModal()" id="add-manual-hours" class="action-btn btn btn-secondary w-full" data-action="add-manual-hours" aria-label="Zadat hodiny ruƒçnƒõ">Zadat Hodiny</button>
                    <button onclick="openManualTaskModal()" id="add-manual-tasks" class="action-btn btn btn-secondary w-full" data-action="add-manual-tasks" aria-label="Zadat stoly ruƒçnƒõ">Zadat Stoly</button>
                </div>
            </div>

            <h2 style="font-size: 18px; margin-bottom: 16px;">üìÑ V≈°echny Z√°znamy</h2>
            <div class="card mb-16">
                <h3 class="mb-16" style="font-size: 16px;">Filtry z√°znam≈Ø</h3>
                <div class="form-group">
                    <label class="form-label">Typ</label>
                    <select id="records-filter" class="filter-select form-control" data-role="filter" data-field="type" aria-label="Filtr podle typu z√°znamu">
                        <option value="all">V≈°e</option>
                        <option value="task">Stoly</option>
                        <option value="hourly">Hodiny</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Pracovn√≠k</label>
                    <select id="records-worker-filter" class="filter-select form-control" data-role="filter" data-field="worker" aria-label="Filtr podle pracovn√≠ka">
                        <option value="">V≈°ichni pracovn√≠ci</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Projekt</label>
                    <select id="records-project-filter" class="filter-select form-control" data-role="filter" data-field="project" aria-label="Filtr podle projektu">
                        <option value="">V≈°echny projekty</option>
                    </select>
                </div>
                <div class="form-group mb-8">
                    <label class="form-label">Obdob√≠</label>
                    <select id="records-date-filter" class="filter-select form-control" data-role="filter" data-field="date" aria-label="Filtr podle obdob√≠">
                        <option value="all">V≈°echna data</option>
                        <option value="today">Dnes</option>
                        <option value="this_week">Tento t√Ωden</option>
                        <option value="this_month">Tento mƒõs√≠c</option>
                    </select>
                </div>
            </div>

            <div id="records-list" data-content="records-list" role="list" aria-label="Seznam z√°znam≈Ø"></div>
        </div>

        <div id="page-statistics" class="page" data-page-name="statistics">
            <div class="stats-grid">
                <div class="stat-card" data-kpi="total-earnings"><div class="stat-value" id="stat-total-earnings" data-value="total-earnings">‚Ç¨0</div><div class="stat-label">Celkov√© V√Ωdƒõlky</div></div>
                <div class="stat-card" data-kpi="total-hours"><div class="stat-value" id="stat-total-hours" data-value="total-hours">0h</div><div class="stat-label">Celkov√© Hodiny</div></div>
                <div class="stat-card" data-kpi="total-tables"><div class="stat-value" id="stat-total-tables" data-value="total-tables">0</div><div class="stat-label">Celkem Stol≈Ø</div></div>
                <div class="stat-card" data-kpi="avg-reward"><div class="stat-value" id="stat-avg-reward" data-value="avg-reward">‚Ç¨0</div><div class="stat-label">Pr≈Ømƒõr/St≈Øl</div></div>
            </div>
            <div class="card mb-16">
                <h3 class="mb-16" style="font-size: 16px;">Filtry</h3>
                <div class="form-group"><label class="form-label">Pracovn√≠k</label><select id="stats-worker-filter" class="filter-select form-control" data-role="filter" data-field="stats-worker" aria-label="Filtr pracovn√≠ka pro statistiky"><option value="">V≈°ichni pracovn√≠ci</option></select></div>
                <div class="form-group"><label class="form-label">Projekt</label><select id="stats-project-filter" class="filter-select form-control" data-role="filter" data-field="stats-project" aria-label="Filtr projektu pro statistiky"><option value="">V≈°echny projekty</option></select></div>
            </div>
            <h3 class="mb-16" style="font-size: 16px;">üìà V√Ωdƒõlky podle Pracovn√≠k≈Ø</h3>
            <div id="worker-earnings-chart" class="chart-placeholder" data-chart="worker-earnings" role="img" aria-label="Graf v√Ωdƒõlk≈Ø podle pracovn√≠k≈Ø"><div>Graf se zobraz√≠ zde</div></div>
            <h3 class="mb-16" style="font-size: 16px;">üìä Rozdƒõlen√≠: Stoly vs Hodiny</h3>
            <div id="task-vs-hourly-chart" class="chart-placeholder" data-chart="task-vs-hourly" role="img" aria-label="Graf rozdƒõlen√≠ stoly vs hodiny"><div>Graf se zobraz√≠ zde</div></div>
        </div>

        <div id="page-settings" class="page" data-page-name="settings">
            <div class="card mb-24">
                <h2 class="mb-16" style="font-size: 18px;">üíº Spr√°va Projekt≈Ø</h2>
                <button onclick="openProjectModal()" id="add-new-project" class="action-btn btn btn-primary w-full mb-16" data-action="add-project" aria-label="P≈ôidat nov√Ω projekt">P≈ôidat Nov√Ω Projekt</button>
                <div id="projects-list" data-content="projects-list" role="list" aria-label="Seznam projekt≈Ø"></div>
            </div>
            <div class="card mb-24">
                <h2 class="mb-16" style="font-size: 18px;">üë• Spr√°va Pracovn√≠k≈Ø</h2>
                <button onclick="openWorkerModal()" id="add-new-worker" class="action-btn btn btn-primary w-full mb-16" data-action="add-worker" aria-label="P≈ôidat nov√©ho pracovn√≠ka">P≈ôidat Nov√©ho Pracovn√≠ka</button>
                <div id="workers-list" data-content="workers-list" role="list" aria-label="Seznam pracovn√≠k≈Ø"></div>
            </div>
            <div class="card mb-24">
                <h2 class="mb-16" style="font-size: 18px;">üìÖ Denn√≠ Report</h2>
                <div class="form-group"><label class="form-label">Datum</label><input type="date" id="report-date" class="date-input form-control" data-field="report-date" aria-label="Datum pro report"></div>
                <button onclick="generateDailyReport()" id="generate-report" class="action-btn btn btn-primary w-full" data-action="generate-report" aria-label="Generovat denn√≠ report">Generovat Denn√≠ Report</button>
            </div>
            <div class="card mb-24">
                <h2 class="mb-16" style="font-size: 18px;">üóúÔ∏è Z√°loha a Export</h2>
                <div class="flex gap-8 mb-12">
                    <button id="backup-data" class="action-btn btn btn-secondary w-full" data-action="backup-data" aria-label="Z√°lohovat v≈°echna data">Z√°lohovat Data</button>
                    <button id="restore-data" class="action-btn btn btn-primary w-full" data-action="restore-data" aria-label="Obnovit data ze z√°lohy">Obnovit Data</button>
                </div>
                <button id="export-csv" class="action-btn btn btn-secondary w-full" data-action="export-csv" aria-label="Exportovat z√°znamy do CSV" style="background: rgba(34, 197, 94, 0.2); color: var(--color-success); border-color: var(--color-success);">üìÅ Exportovat Z√°znamy (CSV)</button>
                <input type="file" id="restore-file-input" class="file-input" data-field="restore-file" accept="application/json" style="display: none;" aria-label="Vybrat soubor z√°lohy">
                <p style="font-size: 12px; color: var(--color-text-secondary); margin-top: 12px;">Z√°loha (.json) ulo≈æ√≠ v≈°e (vƒçetnƒõ PDF). Export (.csv) ulo≈æ√≠ pouze z√°znamy o pr√°ci pro Excel.</p>
            </div>
        </div>
    </div>

    <nav class="bottom-nav" role="navigation" aria-label="Hlavn√≠ navigace">
        <div class="nav-item active" onclick="navigateTo('plan')" data-page="plan" data-nav="plan" role="button" tabindex="0" aria-label="P≈ôej√≠t na pl√°n"><div class="nav-icon">üìã</div><div class="nav-label">Pl√°n</div></div>
        <div class="nav-item" onclick="navigateTo('records')" data-page="records" data-nav="records" role="button" tabindex="0" aria-label="P≈ôej√≠t na z√°znamy"><div class="nav-icon">üìù</div><div class="nav-label">Z√°znamy</div></div>
        <div class="nav-item" onclick="navigateTo('statistics')" data-page="statistics" data-nav="statistics" role="button" tabindex="0" aria-label="P≈ôej√≠t na statistiky"><div class="nav-icon">üìà</div><div class="nav-label">Statistiky</div></div>
        <div class="nav-item" onclick="navigateTo('settings')" data-page="settings" data-nav="settings" role="button" tabindex="0" aria-label="P≈ôej√≠t na nastaven√≠"><div class="nav-icon">‚öôÔ∏è</div><div class="nav-label">Nastaven√≠</div></div>
    </nav>

    <script>
        function connectCompatibilityIds() {
            const idMappings = { 'projectSelect': 'project-picker', 'planTitle': 'plan-title', 'planActions': 'plan-actions', 'planStatsButton': 'plan-stats-button', 'planEditButton': 'plan-edit-button', 'pdfControls': 'pdf-controls', 'prevPage': 'prev-page', 'nextPage': 'next-page', 'pageIndicator': 'page-indicator', 'zoomOut': 'zoom-out', 'zoomIn': 'zoom-in', 'resetZoom': 'reset-zoom', 'canvasWrapper': 'canvas-wrapper', 'pdfCanvas': 'pdf-canvas', 'noPlanMessage': 'no-plan-message', 'workerBadgesContainer': 'worker-badges-container', 'workerBadges': 'worker-badges', 'recordsList': 'records-list', 'timerWorker': 'timer-worker', 'timerDisplay': 'timer-display', 'startShift': 'start-shift', 'stopShift': 'stop-shift', 'recordsFilter': 'records-filter', 'recordsWorkerFilter': 'records-worker-filter', 'recordsProjectFilter': 'records-project-filter', 'recordsDateFilter': 'records-date-filter', 'statsWorkerFilter': 'stats-worker-filter', 'statsProjectFilter': 'stats-project-filter', 'statTotalEarnings': 'stat-total-earnings', 'statTotalHours': 'stat-total-hours', 'statTotalTables': 'stat-total-tables', 'statAvgReward': 'stat-avg-reward', 'workerEarningsChart': 'worker-earnings-chart', 'taskVsHourlyChart': 'task-vs-hourly-chart', 'projectsList': 'projects-list', 'workersList': 'workers-list', 'reportDate': 'report-date', 'backupButton': 'backup-data', 'restoreButton': 'restore-data', 'exportCSV': 'export-csv', 'restoreFileInput': 'restore-file-input', 'reportContent': 'report-content', 'projectModal': 'project-modal', 'projectModalTitle': 'project-modal-title', 'projectId': 'project-id', 'projectName': 'project-name', 'projectPDF': 'project-pdf', 'currentPDF': 'current-pdf', 'projectForm': 'project-form', 'workerModal': 'worker-modal', 'workerModalTitle': 'worker-modal-title', 'workerId': 'worker-id', 'workerName': 'worker-name', 'workerCode': 'worker-code', 'workerRate': 'worker-rate', 'workerForm': 'worker-form', 'taskModal': 'task-modal', 'taskModalTitle': 'task-modal-title', 'taskEntryId': 'task-entry-id', 'taskX': 'task-x', 'taskY': 'task-y', 'taskWorkerChecklist': 'task-worker-checklist', 'taskTableNumber': 'table-number', 'taskRewardPerWorker': 'reward-per-worker', 'taskForm': 'task-form', 'manualHourModal': 'manual-hour-modal', 'manualHourForm': 'manual-hour-form', 'manualHourWorker': 'manual-hour-worker', 'manualHourDate': 'manual-hour-date', 'manualHourTotalHours': 'manual-hour-total-hours', 'manualTaskModal': 'manual-task-modal', 'manualTaskForm': 'manual-task-form', 'manualTaskWorkerChecklist': 'manual-task-worker-checklist', 'manualTaskProject': 'manual-task-project', 'manualTaskDate': 'manual-task-date', 'manualTaskTableNumbers': 'manual-task-table-numbers', 'manualTaskRewardPerWorker': 'manual-task-reward-per-worker', 'reportModal': 'report-modal' };
            Object.entries(idMappings).forEach(([oldId, newId]) => { const el = document.getElementById(newId); if (el && !document.getElementById(oldId)) { el.id = oldId; el.setAttribute('data-new-id', newId); } });
        }
        function toggleAIMode() { if (window.SolarWorkAPI) { window.SolarWorkAPI.aiMode ? window.SolarWorkAPI.disableAIMode() : window.SolarWorkAPI.enableAIMode(); } else { showToast('AI API nen√≠ k dispozici', 'error'); } }
        document.addEventListener('DOMContentLoaded', connectCompatibilityIds);
    </script>

    <script src="app.js"></script>
    <script src="ai-api-v4.1.js"></script>
</body>
</html>